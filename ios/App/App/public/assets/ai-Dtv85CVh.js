function e(e,t,s,n,r){if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,s),s}function t(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)}let s=function(){const{crypto:e}=globalThis;if(null==e?void 0:e.randomUUID)return s=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^n()&15>>+e/4).toString(16))};function n(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const r=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};class i extends Error{}class o extends i{constructor(e,t,s,n){super(`${o.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.requestID=null==n?void 0:n.get("request-id"),this.error=t}static makeMessage(e,t,s){const n=(null==t?void 0:t.message)?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e||!n)return new l({message:s,cause:r(t)});const i=t;return 400===e?new u(e,i,s,n):401===e?new h(e,i,s,n):403===e?new d(e,i,s,n):404===e?new p(e,i,s,n):409===e?new f(e,i,s,n):422===e?new g(e,i,s,n):429===e?new m(e,i,s,n):e>=500?new y(e,i,s,n):new o(e,i,s,n)}}class a extends o{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class l extends o{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class c extends l{constructor({message:e}={}){super({message:e??"Request timed out."})}}class u extends o{}class h extends o{}class d extends o{}class p extends o{}class f extends o{}class g extends o{}class m extends o{}class y extends o{}const b=/^[a-z][a-z0-9+.-]*:/i;let w=e=>(w=Array.isArray,w(e)),v=w;function _(e){return"object"!=typeof e?{}:e??{}}const k=e=>{try{return JSON.parse(e)}catch(t){return}},S="0.59.0";const x=()=>{var e;const t="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===t)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":S,"X-Stainless-OS":M(Deno.build.os),"X-Stainless-Arch":R(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:(null==(e=Deno.version)?void 0:e.deno)??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":S,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===t)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":S,"X-Stainless-OS":M(globalThis.process.platform??"unknown"),"X-Stainless-Arch":R(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const s=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:s}of e){const e=s.exec(navigator.userAgent);if(e){return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":S,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":S,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const R=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",M=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let $;function O(...e){const t=globalThis.ReadableStream;if(void 0===t)throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function P(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return O({start(){},async pull(e){const{done:s,value:n}=await t.next();s?e.close():e.enqueue(n)},async cancel(){var e;await(null==(e=t.return)?void 0:e.call(t))}})}function q(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return(null==e?void 0:e.done)&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const A=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});let T,E;function I(e){let t;return(T??(t=new globalThis.TextEncoder,T=t.encode.bind(t)))(e)}function j(e){let t;return(E??(t=new globalThis.TextDecoder,E=t.decode.bind(t)))(e)}var L,N;class U{constructor(){L.set(this,void 0),N.set(this,void 0),e(this,L,new Uint8Array),e(this,N,null)}decode(s){if(null==s)return[];const n=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?I(s):s;e(this,L,function(e){let t=0;for(const r of e)t+=r.length;const s=new Uint8Array(t);let n=0;for(const r of e)s.set(r,n),n+=r.length;return s}([t(this,L,"f"),n]));const r=[];let i;for(;null!=(i=W(t(this,L,"f"),t(this,N,"f")));){if(i.carriage&&null==t(this,N,"f")){e(this,N,i.index);continue}if(null!=t(this,N,"f")&&(i.index!==t(this,N,"f")+1||i.carriage)){r.push(j(t(this,L,"f").subarray(0,t(this,N,"f")-1))),e(this,L,t(this,L,"f").subarray(t(this,N,"f"))),e(this,N,null);continue}const s=null!==t(this,N,"f")?i.preceding-1:i.preceding,n=j(t(this,L,"f").subarray(0,s));r.push(n),e(this,L,t(this,L,"f").subarray(i.index)),e(this,N,null)}return r}flush(){return t(this,L,"f").length?this.decode("\n"):[]}}function W(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}function D(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}L=new WeakMap,N=new WeakMap,U.NEWLINE_CHARS=new Set(["\n","\r"]),U.NEWLINE_REGEXP=/\r\n|[\n\r]/g;const C={off:0,error:200,warn:300,info:400,debug:500},X=(e,t,s)=>{var n,r;if(e)return n=C,r=e,Object.prototype.hasOwnProperty.call(n,r)?e:void K(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(C))}`)};function H(){}function B(e,t,s){return!t||C[e]>C[s]?H:t[e].bind(t)}const J={error:H,warn:H,info:H,debug:H};let F=new WeakMap;function K(e){const t=e.logger,s=e.logLevel??"off";if(!t)return J;const n=F.get(t);if(n&&n[0]===s)return n[1];const r={error:B("error",t,s),warn:B("warn",t,s),info:B("info",t,s),debug:B("debug",t,s)};return F.set(t,[s,r]),r}const V=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"x-api-key"===e.toLowerCase()||"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);var z,G,Q;class Y{constructor(t,s,n){this.iterator=t,z.set(this,void 0),this.controller=s,e(this,z,n)}static fromSSEResponse(e,t,s){let r=!1;const a=s?K(s):console;return new Y(async function*(){if(r)throw new i("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(const s of async function*(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new i("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new i("Attempted to iterate over a response with no body")}const s=new Z,n=new U,r=q(e.body);for await(const i of async function*(e){let t=new Uint8Array;for await(const s of e){if(null==s)continue;const e=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?I(s):s;let n,r=new Uint8Array(t.length+e.length);for(r.set(t),r.set(e,t.length),t=r;-1!==(n=D(t));)yield t.slice(0,n),t=t.slice(n)}t.length>0&&(yield t)}(r))for(const e of n.decode(i)){const t=s.decode(e);t&&(yield t)}for(const i of n.flush()){const e=s.decode(i);e&&(yield e)}}(e,t)){if("completion"===s.event)try{yield JSON.parse(s.data)}catch(l){throw a.error("Could not parse message into JSON:",s.data),a.error("From chunk:",s.raw),l}if("message_start"===s.event||"message_delta"===s.event||"message_stop"===s.event||"content_block_start"===s.event||"content_block_delta"===s.event||"content_block_stop"===s.event)try{yield JSON.parse(s.data)}catch(l){throw a.error("Could not parse message into JSON:",s.data),a.error("From chunk:",s.raw),l}if("ping"!==s.event&&"error"===s.event)throw new o(void 0,k(s.data)??s.data,void 0,e.headers)}s=!0}catch(l){if(n(l))return;throw l}finally{s||t.abort()}},t,s)}static fromReadableStream(e,t,s){let r=!1;return new Y(async function*(){if(r)throw new i("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(const t of async function*(){const t=new U,s=q(e);for await(const e of s)for(const s of t.decode(e))yield s;for(const e of t.flush())yield e}())s||t&&(yield JSON.parse(t));s=!0}catch(o){if(n(o))return;throw o}finally{s||t.abort()}},t,s)}[(z=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],s=[],n=this.iterator(),r=t=>({next:()=>{if(0===t.length){const t=n.next();e.push(t),s.push(t)}return t.shift()}});return[new Y(()=>r(e),this.controller,t(this,z,"f")),new Y(()=>r(s),this.controller,t(this,z,"f"))]}toReadableStream(){const e=this;let t;return O({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:s,done:n}=await t.next();if(n)return e.close();const r=I(JSON.stringify(s)+"\n");e.enqueue(r)}catch(s){e.error(s)}},async cancel(){var e;await(null==(e=t.return)?void 0:e.call(t))}})}}class Z{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,n]=function(e,t){const s=e.indexOf(t);if(-1!==s)return[e.substring(0,s),t,e.substring(s+t.length)];return[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}async function ee(e,t){const{response:s,requestLogID:n,retryOfRequestLogID:r,startTime:i}=t,o=await(async()=>{var n;if(t.options.stream)return K(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(s,t.controller):Y.fromSSEResponse(s,t.controller);if(204===s.status)return null;if(t.options.__binaryResponse)return s;const r=s.headers.get("content-type"),i=null==(n=null==r?void 0:r.split(";")[0])?void 0:n.trim();if((null==i?void 0:i.includes("application/json"))||(null==i?void 0:i.endsWith("+json"))){return te(await s.json(),s)}return await s.text()})();return K(e).debug(`[${n}] response parsed`,V({retryOfRequestLogID:r,url:s.url,status:s.status,body:o,durationMs:Date.now()-i})),o}function te(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("request-id"),enumerable:!1})}class se extends Promise{constructor(t,s,n=ee){super(e=>{e(null)}),this.responsePromise=s,this.parseResponse=n,G.set(this,void 0),e(this,G,t)}_thenUnwrap(e){return new se(t(this,G,"f"),this.responsePromise,async(t,s)=>te(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(t(this,G,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}G=new WeakMap;class ne{constructor(t,s,n,r){Q.set(this,void 0),e(this,Q,t),this.options=r,this.response=s,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new i("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await t(this,Q,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Q=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class re extends se{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await ee(e,t),t.options))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}class ie extends ne{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1,this.first_id=s.first_id||null,this.last_id=s.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){var e;if(null==(e=this.options.query)?void 0:e.before_id){const e=this.first_id;return e?{...this.options,query:{..._(this.options.query),before_id:e}}:null}const t=this.last_id;return t?{...this.options,query:{..._(this.options.query),after_id:t}}:null}}const oe=()=>{var e;if("undefined"==typeof File){const{process:t}=globalThis,s="string"==typeof(null==(e=null==t?void 0:t.versions)?void 0:e.node)&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(s?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function ae(e,t,s){return oe(),new File(e,t??"unknown_file",s)}function le(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const ce=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],ue=new WeakMap;const he=async(e,t)=>{if(!(await function(e){const t="function"==typeof e?e:e.fetch,s=ue.get(t);if(s)return s;const n=(async()=>{try{const e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;return s.toString()!==await new e(s).text()}catch{return!0}})();return ue.set(t,n),n}(t)))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>de(s,e,t))),s},de=async(e,t,s)=>{if(void 0!==s){if(null==s)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response){let n={};const r=s.headers.get("Content-Type");r&&(n={type:r}),e.append(t,ae([await s.blob()],le(s),n))}else if(ce(s))e.append(t,ae([await new Response(P(s)).blob()],le(s)));else if((e=>e instanceof Blob&&"name"in e)(s))e.append(t,ae([s],le(s),{type:s.type}));else if(Array.isArray(s))await Promise.all(s.map(s=>de(e,t+"[]",s)));else{if("object"!=typeof s)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`);await Promise.all(Object.entries(s).map(([s,n])=>de(e,`${t}[${s}]`,n)))}}},pe=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function fe(e){var t;let s=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)s.push(e);else if(pe(e))s.push(e instanceof Blob?e:await e.arrayBuffer());else{if(!ce(e)){const s=null==(t=null==e?void 0:e.constructor)?void 0:t.name;throw new Error(`Unexpected data type: ${typeof e}${s?`; constructor: ${s}`:""}${function(e){if("object"!=typeof e||null===e)return"";const t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}for await(const t of e)s.push(...await fe(t))}return s}class ge{constructor(e){this._client=e}}const me=Symbol.for("brand.privateNullableHeaders");function*ye(e){if(!e)return;if(me in e){const{values:t,nulls:s}=e;yield*t.entries();for(const e of s)yield[e,null];return}let t,s=!1;e instanceof Headers?t=e.entries():v(e)?t=e:(s=!0,t=Object.entries(e??{}));for(let n of t){const e=n[0];if("string"!=typeof e)throw new TypeError("expected header name to be a string");const t=v(n[1])?n[1]:[n[1]];let r=!1;for(const n of t)void 0!==n&&(s&&!r&&(r=!0,yield[e,null]),yield[e,n])}}const be=e=>{const t=new Headers,s=new Set;for(const n of e){const e=new Set;for(const[r,i]of ye(n)){const n=r.toLowerCase();e.has(n)||(t.delete(r),e.add(n)),null===i?(t.delete(r),s.add(n)):(t.append(r,i),s.delete(n))}}return{[me]:!0,values:t,nulls:s}};function we(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const ve=Object.freeze(Object.create(null)),_e=((e=we)=>function(t,...s){if(1===t.length)return t[0];let n=!1;const r=[],o=t.reduce((t,i,o)=>{var a;/[?#]/.test(i)&&(n=!0);const l=s[o];let c=(n?encodeURIComponent:e)(""+l);return o!==s.length&&(null==l||"object"==typeof l&&l.toString===(null==(a=Object.getPrototypeOf(Object.getPrototypeOf(l.hasOwnProperty??ve)??ve))?void 0:a.toString))&&(c=l+"",r.push({start:t.length+i.length,length:c.length,error:`Value of type ${Object.prototype.toString.call(l).slice(8,-1)} is not a valid path parameter`})),t+i+(o===s.length?"":c)},""),a=o.split(/[?#]/,1)[0],l=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let c;for(;null!==(c=l.exec(a));)r.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(r.sort((e,t)=>e.start-t.start),r.length>0){let e=0;const t=r.reduce((t,s)=>{const n=" ".repeat(s.start-e),r="^".repeat(s.length);return e=s.start+s.length,t+n+r},"");throw new i(`Path parameters result in path with invalid segments:\n${r.map(e=>e.error).join("\n")}\n${o}\n${t}`)}return o})(we);class ke extends ge{list(e={},t){const{betas:s,...n}=e??{};return this._client.getAPIList("/v1/files",ie,{query:n,...t,headers:be([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},null==t?void 0:t.headers])})}delete(e,t={},s){const{betas:n}=t??{};return this._client.delete(_e`/v1/files/${e}`,{...s,headers:be([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString()},null==s?void 0:s.headers])})}download(e,t={},s){const{betas:n}=t??{};return this._client.get(_e`/v1/files/${e}/content`,{...s,headers:be([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},null==s?void 0:s.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},s){const{betas:n}=t??{};return this._client.get(_e`/v1/files/${e}`,{...s,headers:be([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString()},null==s?void 0:s.headers])})}upload(e,t){const{betas:s,...n}=e;return this._client.post("/v1/files",(async(e,t)=>({...e,body:await he(e.body,t)}))({body:n,...t,headers:be([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},null==t?void 0:t.headers])},this._client))}}let Se=class extends ge{retrieve(e,t={},s){const{betas:n}=t??{};return this._client.get(_e`/v1/models/${e}?beta=true`,{...s,headers:be([{...null!=(null==n?void 0:n.toString())?{"anthropic-beta":null==n?void 0:n.toString()}:void 0},null==s?void 0:s.headers])})}list(e={},t){const{betas:s,...n}=e??{};return this._client.getAPIList("/v1/models?beta=true",ie,{query:n,...t,headers:be([{...null!=(null==s?void 0:s.toString())?{"anthropic-beta":null==s?void 0:s.toString()}:void 0},null==t?void 0:t.headers])})}};class xe{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new U;for await(const t of this.iterator)for(const s of e.decode(t))yield JSON.parse(s);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new i("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new i("Attempted to iterate over a response with no body")}return new xe(q(e.body),t)}}let Re=class extends ge{create(e,t){const{betas:s,...n}=e;return this._client.post("/v1/messages/batches?beta=true",{body:n,...t,headers:be([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},null==t?void 0:t.headers])})}retrieve(e,t={},s){const{betas:n}=t??{};return this._client.get(_e`/v1/messages/batches/${e}?beta=true`,{...s,headers:be([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},null==s?void 0:s.headers])})}list(e={},t){const{betas:s,...n}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",ie,{query:n,...t,headers:be([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},null==t?void 0:t.headers])})}delete(e,t={},s){const{betas:n}=t??{};return this._client.delete(_e`/v1/messages/batches/${e}?beta=true`,{...s,headers:be([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},null==s?void 0:s.headers])})}cancel(e,t={},s){const{betas:n}=t??{};return this._client.post(_e`/v1/messages/batches/${e}/cancel?beta=true`,{...s,headers:be([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},null==s?void 0:s.headers])})}async results(e,t={},s){const n=await this.retrieve(e);if(!n.results_url)throw new i(`No batch \`results_url\`; Has it finished processing? ${n.processing_status} - ${n.id}`);const{betas:r}=t??{};return this._client.get(n.results_url,{...s,headers:be([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},null==s?void 0:s.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((e,t)=>xe.fromResponse(t.response,t.controller))}};const Me=e=>{if(0===e.length)return e;let t=e[e.length-1];switch(t.type){case"separator":return e=e.slice(0,e.length-1),Me(e);case"number":let s=t.value[t.value.length-1];if("."===s||"-"===s)return e=e.slice(0,e.length-1),Me(e);case"string":let n=e[e.length-2];if("delimiter"===(null==n?void 0:n.type))return e=e.slice(0,e.length-1),Me(e);if("brace"===(null==n?void 0:n.type)&&"{"===n.value)return e=e.slice(0,e.length-1),Me(e);break;case"delimiter":return e=e.slice(0,e.length-1),Me(e)}return e},$e=e=>JSON.parse((e=>{let t="";return e.map(e=>{"string"===e.type?t+='"'+e.value+'"':t+=e.value}),t})((e=>{let t=[];return e.map(e=>{"brace"===e.type&&("{"===e.value?t.push("}"):t.splice(t.lastIndexOf("}"),1)),"paren"===e.type&&("["===e.value?t.push("]"):t.splice(t.lastIndexOf("]"),1))}),t.length>0&&t.reverse().map(t=>{"}"===t?e.push({type:"brace",value:"}"}):"]"===t&&e.push({type:"paren",value:"]"})}),e})(Me((e=>{let t=0,s=[];for(;t<e.length;){let n=e[t];if("\\"===n){t++;continue}if("{"===n){s.push({type:"brace",value:"{"}),t++;continue}if("}"===n){s.push({type:"brace",value:"}"}),t++;continue}if("["===n){s.push({type:"paren",value:"["}),t++;continue}if("]"===n){s.push({type:"paren",value:"]"}),t++;continue}if(":"===n){s.push({type:"separator",value:":"}),t++;continue}if(","===n){s.push({type:"delimiter",value:","}),t++;continue}if('"'===n){let r="",i=!1;for(n=e[++t];'"'!==n;){if(t===e.length){i=!0;break}if("\\"===n){if(t++,t===e.length){i=!0;break}r+=n+e[t],n=e[++t]}else r+=n,n=e[++t]}n=e[++t],i||s.push({type:"string",value:r});continue}if(n&&/\s/.test(n)){t++;continue}let r=/[0-9]/;if(n&&r.test(n)||"-"===n||"."===n){let i="";for("-"===n&&(i+=n,n=e[++t]);n&&r.test(n)||"."===n;)i+=n,n=e[++t];s.push({type:"number",value:i});continue}let i=/[a-z]/i;if(n&&i.test(n)){let r="";for(;n&&i.test(n)&&t!==e.length;)r+=n,n=e[++t];if("true"!=r&&"false"!=r&&"null"!==r){t++;continue}s.push({type:"name",value:r});continue}t++}return s})(e)))));var Oe,Pe,qe,Ae,Te,Ee,Ie,je,Le,Ne,Ue,We,De,Ce,Xe,He,Be,Je,Fe,Ke,Ve,ze;const Ge="__json_buf";function Qe(e){return"tool_use"===e.type||"server_tool_use"===e.type||"mcp_tool_use"===e.type}class Ye{constructor(){Oe.add(this),this.messages=[],this.receivedMessages=[],Pe.set(this,void 0),this.controller=new AbortController,qe.set(this,void 0),Ae.set(this,()=>{}),Te.set(this,()=>{}),Ee.set(this,void 0),Ie.set(this,()=>{}),je.set(this,()=>{}),Le.set(this,{}),Ne.set(this,!1),Ue.set(this,!1),We.set(this,!1),De.set(this,!1),Ce.set(this,void 0),Xe.set(this,void 0),Je.set(this,t=>{if(e(this,Ue,!0),n(t)&&(t=new a),t instanceof a)return e(this,We,!0),this._emit("abort",t);if(t instanceof i)return this._emit("error",t);if(t instanceof Error){const e=new i(t.message);return e.cause=t,this._emit("error",e)}return this._emit("error",new i(String(t)))}),e(this,qe,new Promise((t,s)=>{e(this,Ae,t),e(this,Te,s)})),e(this,Ee,new Promise((t,s)=>{e(this,Ie,t),e(this,je,s)})),t(this,qe,"f").catch(()=>{}),t(this,Ee,"f").catch(()=>{})}get response(){return t(this,Ce,"f")}get request_id(){return t(this,Xe,"f")}async withResponse(){const e=await t(this,qe,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new Ye;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s){const n=new Ye;for(const r of t.messages)n._addMessageParam(r);return n._run(()=>n._createMessage(e,{...t,stream:!0},{...s,headers:{...null==s?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),n}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},t(this,Je,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,s,n){var r;const i=null==n?void 0:n.signal;let o;i&&(i.aborted&&this.controller.abort(),o=this.controller.abort.bind(this.controller),i.addEventListener("abort",o));try{t(this,Oe,"m",Fe).call(this);const{response:i,data:o}=await e.create({...s,stream:!0},{...n,signal:this.controller.signal}).withResponse();this._connected(i);for await(const e of o)t(this,Oe,"m",Ke).call(this,e);if(null==(r=o.controller.signal)?void 0:r.aborted)throw new a;t(this,Oe,"m",Ve).call(this)}finally{i&&o&&i.removeEventListener("abort",o)}}_connected(s){this.ended||(e(this,Ce,s),e(this,Xe,null==s?void 0:s.headers.get("request-id")),t(this,Ae,"f").call(this,s),this._emit("connect"))}get ended(){return t(this,Ne,"f")}get errored(){return t(this,Ue,"f")}get aborted(){return t(this,We,"f")}abort(){this.controller.abort()}on(e,s){return(t(this,Le,"f")[e]||(t(this,Le,"f")[e]=[])).push({listener:s}),this}off(e,s){const n=t(this,Le,"f")[e];if(!n)return this;const r=n.findIndex(e=>e.listener===s);return r>=0&&n.splice(r,1),this}once(e,s){return(t(this,Le,"f")[e]||(t(this,Le,"f")[e]=[])).push({listener:s,once:!0}),this}emitted(t){return new Promise((s,n)=>{e(this,De,!0),"error"!==t&&this.once("error",n),this.once(t,s)})}async done(){e(this,De,!0),await t(this,Ee,"f")}get currentMessage(){return t(this,Pe,"f")}async finalMessage(){return await this.done(),t(this,Oe,"m",He).call(this)}async finalText(){return await this.done(),t(this,Oe,"m",Be).call(this)}_emit(s,...n){if(t(this,Ne,"f"))return;"end"===s&&(e(this,Ne,!0),t(this,Ie,"f").call(this));const r=t(this,Le,"f")[s];if(r&&(t(this,Le,"f")[s]=r.filter(e=>!e.once),r.forEach(({listener:e})=>e(...n))),"abort"===s){const e=n[0];return t(this,De,"f")||(null==r?void 0:r.length)||Promise.reject(e),t(this,Te,"f").call(this,e),t(this,je,"f").call(this,e),void this._emit("end")}if("error"===s){const e=n[0];t(this,De,"f")||(null==r?void 0:r.length)||Promise.reject(e),t(this,Te,"f").call(this,e),t(this,je,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",t(this,Oe,"m",He).call(this))}async _fromReadableStream(e,s){var n;const r=null==s?void 0:s.signal;let i;r&&(r.aborted&&this.controller.abort(),i=this.controller.abort.bind(this.controller),r.addEventListener("abort",i));try{t(this,Oe,"m",Fe).call(this),this._connected(null);const s=Y.fromReadableStream(e,this.controller);for await(const e of s)t(this,Oe,"m",Ke).call(this,e);if(null==(n=s.controller.signal)?void 0:n.aborted)throw new a;t(this,Oe,"m",Ve).call(this)}finally{r&&i&&r.removeEventListener("abort",i)}}[(Pe=new WeakMap,qe=new WeakMap,Ae=new WeakMap,Te=new WeakMap,Ee=new WeakMap,Ie=new WeakMap,je=new WeakMap,Le=new WeakMap,Ne=new WeakMap,Ue=new WeakMap,We=new WeakMap,De=new WeakMap,Ce=new WeakMap,Xe=new WeakMap,Je=new WeakMap,Oe=new WeakSet,He=function(){if(0===this.receivedMessages.length)throw new i("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Be=function(){if(0===this.receivedMessages.length)throw new i("stream ended without producing a Message with role=assistant");const e=this.receivedMessages.at(-1).content.filter(e=>"text"===e.type).map(e=>e.text);if(0===e.length)throw new i("stream ended without producing a content block with type=text");return e.join(" ")},Fe=function(){this.ended||e(this,Pe,void 0)},Ke=function(s){if(this.ended)return;const n=t(this,Oe,"m",ze).call(this,s);switch(this._emit("streamEvent",s,n),s.type){case"content_block_delta":{const e=n.content.at(-1);switch(s.delta.type){case"text_delta":"text"===e.type&&this._emit("text",s.delta.text,e.text||"");break;case"citations_delta":"text"===e.type&&this._emit("citation",s.delta.citation,e.citations??[]);break;case"input_json_delta":Qe(e)&&e.input&&this._emit("inputJson",s.delta.partial_json,e.input);break;case"thinking_delta":"thinking"===e.type&&this._emit("thinking",s.delta.thinking,e.thinking);break;case"signature_delta":"thinking"===e.type&&this._emit("signature",e.signature);break;default:s.delta}break}case"message_stop":this._addMessageParam(n),this._addMessage(n,!0);break;case"content_block_stop":this._emit("contentBlock",n.content.at(-1));break;case"message_start":e(this,Pe,n)}},Ve=function(){if(this.ended)throw new i("stream has ended, this shouldn't happen");const s=t(this,Pe,"f");if(!s)throw new i("request ended without sending any chunks");return e(this,Pe,void 0),s},ze=function(e){let s=t(this,Pe,"f");if("message_start"===e.type){if(s)throw new i(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!s)throw new i(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return s;case"message_delta":return s.container=e.delta.container,s.stop_reason=e.delta.stop_reason,s.stop_sequence=e.delta.stop_sequence,s.usage.output_tokens=e.usage.output_tokens,null!=e.usage.input_tokens&&(s.usage.input_tokens=e.usage.input_tokens),null!=e.usage.cache_creation_input_tokens&&(s.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),null!=e.usage.cache_read_input_tokens&&(s.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),null!=e.usage.server_tool_use&&(s.usage.server_tool_use=e.usage.server_tool_use),s;case"content_block_start":return s.content.push(e.content_block),s;case"content_block_delta":{const r=s.content.at(e.index);switch(e.delta.type){case"text_delta":"text"===(null==r?void 0:r.type)&&(s.content[e.index]={...r,text:(r.text||"")+e.delta.text});break;case"citations_delta":"text"===(null==r?void 0:r.type)&&(s.content[e.index]={...r,citations:[...r.citations??[],e.delta.citation]});break;case"input_json_delta":if(r&&Qe(r)){let o=r[Ge]||"";o+=e.delta.partial_json;const a={...r};if(Object.defineProperty(a,Ge,{value:o,enumerable:!1,writable:!0}),o)try{a.input=$e(o)}catch(n){const e=new i(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${n}. JSON: ${o}`);t(this,Je,"f").call(this,e)}s.content[e.index]=a}break;case"thinking_delta":"thinking"===(null==r?void 0:r.type)&&(s.content[e.index]={...r,thinking:r.thinking+e.delta.thinking});break;case"signature_delta":"thinking"===(null==r?void 0:r.type)&&(s.content[e.index]={...r,signature:e.delta.signature});break;default:e.delta}return s}}},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("streamEvent",s=>{const n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{s=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{s=!0;for(const s of t)s.reject(e);t.length=0}),this.on("error",e=>{s=!0;for(const s of t)s.reject(e);t.length=0}),{next:async()=>{if(!e.length)return s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Y(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}const Ze={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192,"claude-opus-4-1-20250805":8192,"anthropic.claude-opus-4-1-20250805-v1:0":8192,"claude-opus-4-1@20250805":8192},et={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};let tt=class extends ge{constructor(){super(...arguments),this.batches=new Re(this._client)}create(e,t){const{betas:s,...n}=e;n.model in et&&console.warn(`The model '${n.model}' is deprecated and will reach end-of-life on ${et[n.model]}\nPlease migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let r=this._client._options.timeout;if(!n.stream&&null==r){const e=Ze[n.model]??void 0;r=this._client.calculateNonstreamingTimeout(n.max_tokens,e)}return this._client.post("/v1/messages?beta=true",{body:n,timeout:r??6e5,...t,headers:be([{...null!=(null==s?void 0:s.toString())?{"anthropic-beta":null==s?void 0:s.toString()}:void 0},null==t?void 0:t.headers]),stream:e.stream??!1})}stream(e,t){return Ye.createMessage(this,e,t)}countTokens(e,t){const{betas:s,...n}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:n,...t,headers:be([{"anthropic-beta":[...s??[],"token-counting-2024-11-01"].toString()},null==t?void 0:t.headers])})}};tt.Batches=Re;class st extends ge{constructor(){super(...arguments),this.models=new Se(this._client),this.messages=new tt(this._client),this.files=new ke(this._client)}}st.Models=Se,st.Messages=tt,st.Files=ke;class nt extends ge{create(e,t){const{betas:s,...n}=e;return this._client.post("/v1/complete",{body:n,timeout:this._client._options.timeout??6e5,...t,headers:be([{...null!=(null==s?void 0:s.toString())?{"anthropic-beta":null==s?void 0:s.toString()}:void 0},null==t?void 0:t.headers]),stream:e.stream??!1})}}var rt,it,ot,at,lt,ct,ut,ht,dt,pt,ft,gt,mt,yt,bt,wt,vt,_t,kt,St,xt,Rt;const Mt="__json_buf";function $t(e){return"tool_use"===e.type||"server_tool_use"===e.type}class Ot{constructor(){rt.add(this),this.messages=[],this.receivedMessages=[],it.set(this,void 0),this.controller=new AbortController,ot.set(this,void 0),at.set(this,()=>{}),lt.set(this,()=>{}),ct.set(this,void 0),ut.set(this,()=>{}),ht.set(this,()=>{}),dt.set(this,{}),pt.set(this,!1),ft.set(this,!1),gt.set(this,!1),mt.set(this,!1),yt.set(this,void 0),bt.set(this,void 0),_t.set(this,t=>{if(e(this,ft,!0),n(t)&&(t=new a),t instanceof a)return e(this,gt,!0),this._emit("abort",t);if(t instanceof i)return this._emit("error",t);if(t instanceof Error){const e=new i(t.message);return e.cause=t,this._emit("error",e)}return this._emit("error",new i(String(t)))}),e(this,ot,new Promise((t,s)=>{e(this,at,t),e(this,lt,s)})),e(this,ct,new Promise((t,s)=>{e(this,ut,t),e(this,ht,s)})),t(this,ot,"f").catch(()=>{}),t(this,ct,"f").catch(()=>{})}get response(){return t(this,yt,"f")}get request_id(){return t(this,bt,"f")}async withResponse(){const e=await t(this,ot,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new Ot;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s){const n=new Ot;for(const r of t.messages)n._addMessageParam(r);return n._run(()=>n._createMessage(e,{...t,stream:!0},{...s,headers:{...null==s?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),n}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},t(this,_t,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,s,n){var r;const i=null==n?void 0:n.signal;let o;i&&(i.aborted&&this.controller.abort(),o=this.controller.abort.bind(this.controller),i.addEventListener("abort",o));try{t(this,rt,"m",kt).call(this);const{response:i,data:o}=await e.create({...s,stream:!0},{...n,signal:this.controller.signal}).withResponse();this._connected(i);for await(const e of o)t(this,rt,"m",St).call(this,e);if(null==(r=o.controller.signal)?void 0:r.aborted)throw new a;t(this,rt,"m",xt).call(this)}finally{i&&o&&i.removeEventListener("abort",o)}}_connected(s){this.ended||(e(this,yt,s),e(this,bt,null==s?void 0:s.headers.get("request-id")),t(this,at,"f").call(this,s),this._emit("connect"))}get ended(){return t(this,pt,"f")}get errored(){return t(this,ft,"f")}get aborted(){return t(this,gt,"f")}abort(){this.controller.abort()}on(e,s){return(t(this,dt,"f")[e]||(t(this,dt,"f")[e]=[])).push({listener:s}),this}off(e,s){const n=t(this,dt,"f")[e];if(!n)return this;const r=n.findIndex(e=>e.listener===s);return r>=0&&n.splice(r,1),this}once(e,s){return(t(this,dt,"f")[e]||(t(this,dt,"f")[e]=[])).push({listener:s,once:!0}),this}emitted(t){return new Promise((s,n)=>{e(this,mt,!0),"error"!==t&&this.once("error",n),this.once(t,s)})}async done(){e(this,mt,!0),await t(this,ct,"f")}get currentMessage(){return t(this,it,"f")}async finalMessage(){return await this.done(),t(this,rt,"m",wt).call(this)}async finalText(){return await this.done(),t(this,rt,"m",vt).call(this)}_emit(s,...n){if(t(this,pt,"f"))return;"end"===s&&(e(this,pt,!0),t(this,ut,"f").call(this));const r=t(this,dt,"f")[s];if(r&&(t(this,dt,"f")[s]=r.filter(e=>!e.once),r.forEach(({listener:e})=>e(...n))),"abort"===s){const e=n[0];return t(this,mt,"f")||(null==r?void 0:r.length)||Promise.reject(e),t(this,lt,"f").call(this,e),t(this,ht,"f").call(this,e),void this._emit("end")}if("error"===s){const e=n[0];t(this,mt,"f")||(null==r?void 0:r.length)||Promise.reject(e),t(this,lt,"f").call(this,e),t(this,ht,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",t(this,rt,"m",wt).call(this))}async _fromReadableStream(e,s){var n;const r=null==s?void 0:s.signal;let i;r&&(r.aborted&&this.controller.abort(),i=this.controller.abort.bind(this.controller),r.addEventListener("abort",i));try{t(this,rt,"m",kt).call(this),this._connected(null);const s=Y.fromReadableStream(e,this.controller);for await(const e of s)t(this,rt,"m",St).call(this,e);if(null==(n=s.controller.signal)?void 0:n.aborted)throw new a;t(this,rt,"m",xt).call(this)}finally{r&&i&&r.removeEventListener("abort",i)}}[(it=new WeakMap,ot=new WeakMap,at=new WeakMap,lt=new WeakMap,ct=new WeakMap,ut=new WeakMap,ht=new WeakMap,dt=new WeakMap,pt=new WeakMap,ft=new WeakMap,gt=new WeakMap,mt=new WeakMap,yt=new WeakMap,bt=new WeakMap,_t=new WeakMap,rt=new WeakSet,wt=function(){if(0===this.receivedMessages.length)throw new i("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},vt=function(){if(0===this.receivedMessages.length)throw new i("stream ended without producing a Message with role=assistant");const e=this.receivedMessages.at(-1).content.filter(e=>"text"===e.type).map(e=>e.text);if(0===e.length)throw new i("stream ended without producing a content block with type=text");return e.join(" ")},kt=function(){this.ended||e(this,it,void 0)},St=function(s){if(this.ended)return;const n=t(this,rt,"m",Rt).call(this,s);switch(this._emit("streamEvent",s,n),s.type){case"content_block_delta":{const e=n.content.at(-1);switch(s.delta.type){case"text_delta":"text"===e.type&&this._emit("text",s.delta.text,e.text||"");break;case"citations_delta":"text"===e.type&&this._emit("citation",s.delta.citation,e.citations??[]);break;case"input_json_delta":$t(e)&&e.input&&this._emit("inputJson",s.delta.partial_json,e.input);break;case"thinking_delta":"thinking"===e.type&&this._emit("thinking",s.delta.thinking,e.thinking);break;case"signature_delta":"thinking"===e.type&&this._emit("signature",e.signature);break;default:s.delta}break}case"message_stop":this._addMessageParam(n),this._addMessage(n,!0);break;case"content_block_stop":this._emit("contentBlock",n.content.at(-1));break;case"message_start":e(this,it,n)}},xt=function(){if(this.ended)throw new i("stream has ended, this shouldn't happen");const s=t(this,it,"f");if(!s)throw new i("request ended without sending any chunks");return e(this,it,void 0),s},Rt=function(e){let s=t(this,it,"f");if("message_start"===e.type){if(s)throw new i(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!s)throw new i(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return s;case"message_delta":return s.stop_reason=e.delta.stop_reason,s.stop_sequence=e.delta.stop_sequence,s.usage.output_tokens=e.usage.output_tokens,null!=e.usage.input_tokens&&(s.usage.input_tokens=e.usage.input_tokens),null!=e.usage.cache_creation_input_tokens&&(s.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),null!=e.usage.cache_read_input_tokens&&(s.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),null!=e.usage.server_tool_use&&(s.usage.server_tool_use=e.usage.server_tool_use),s;case"content_block_start":return s.content.push({...e.content_block}),s;case"content_block_delta":{const t=s.content.at(e.index);switch(e.delta.type){case"text_delta":"text"===(null==t?void 0:t.type)&&(s.content[e.index]={...t,text:(t.text||"")+e.delta.text});break;case"citations_delta":"text"===(null==t?void 0:t.type)&&(s.content[e.index]={...t,citations:[...t.citations??[],e.delta.citation]});break;case"input_json_delta":if(t&&$t(t)){let n=t[Mt]||"";n+=e.delta.partial_json;const r={...t};Object.defineProperty(r,Mt,{value:n,enumerable:!1,writable:!0}),n&&(r.input=$e(n)),s.content[e.index]=r}break;case"thinking_delta":"thinking"===(null==t?void 0:t.type)&&(s.content[e.index]={...t,thinking:t.thinking+e.delta.thinking});break;case"signature_delta":"thinking"===(null==t?void 0:t.type)&&(s.content[e.index]={...t,signature:e.delta.signature});break;default:e.delta}return s}}},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("streamEvent",s=>{const n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{s=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{s=!0;for(const s of t)s.reject(e);t.length=0}),this.on("error",e=>{s=!0;for(const s of t)s.reject(e);t.length=0}),{next:async()=>{if(!e.length)return s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Y(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class Pt extends ge{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(_e`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",ie,{query:e,...t})}delete(e,t){return this._client.delete(_e`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(_e`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){const s=await this.retrieve(e);if(!s.results_url)throw new i(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);return this._client.get(s.results_url,{...t,headers:be([{Accept:"application/binary"},null==t?void 0:t.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((e,t)=>xe.fromResponse(t.response,t.controller))}}class qt extends ge{constructor(){super(...arguments),this.batches=new Pt(this._client)}create(e,t){e.model in At&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${At[e.model]}\nPlease migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let s=this._client._options.timeout;if(!e.stream&&null==s){const t=Ze[e.model]??void 0;s=this._client.calculateNonstreamingTimeout(e.max_tokens,t)}return this._client.post("/v1/messages",{body:e,timeout:s??6e5,...t,stream:e.stream??!1})}stream(e,t){return Ot.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}const At={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};qt.Batches=Pt;class Tt extends ge{retrieve(e,t={},s){const{betas:n}=t??{};return this._client.get(_e`/v1/models/${e}`,{...s,headers:be([{...null!=(null==n?void 0:n.toString())?{"anthropic-beta":null==n?void 0:n.toString()}:void 0},null==s?void 0:s.headers])})}list(e={},t){const{betas:s,...n}=e??{};return this._client.getAPIList("/v1/models",ie,{query:n,...t,headers:be([{...null!=(null==s?void 0:s.toString())?{"anthropic-beta":null==s?void 0:s.toString()}:void 0},null==t?void 0:t.headers])})}}var Et={};const It=e=>{var t,s,n,r;return void 0!==globalThis.process?(null==(t=null==Et?void 0:Et[e])?void 0:t.trim())??void 0:void 0!==globalThis.Deno?null==(r=null==(n=null==(s=globalThis.Deno.env)?void 0:s.get)?void 0:n.call(s,e))?void 0:r.trim():void 0};var jt,Lt,Nt,Ut;class Wt{constructor({baseURL:t=It("ANTHROPIC_BASE_URL"),apiKey:s=It("ANTHROPIC_API_KEY")??null,authToken:n=It("ANTHROPIC_AUTH_TOKEN")??null,...r}={}){jt.add(this),Nt.set(this,void 0);const o={apiKey:s,authToken:n,...r,baseURL:t||"https://api.anthropic.com"};if(!o.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new i("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew Anthropic({ apiKey, dangerouslyAllowBrowser: true });\n");this.baseURL=o.baseURL,this.timeout=o.timeout??Lt.DEFAULT_TIMEOUT,this.logger=o.logger??console;const a="warn";this.logLevel=a,this.logLevel=X(o.logLevel,"ClientOptions.logLevel",this)??X(It("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??a,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),e(this,Nt,A),this._options=o,this.apiKey=s,this.authToken=n}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(this.apiKey&&e.get("x-api-key")||t.has("x-api-key")||this.authToken&&e.get("authorization")||t.has("authorization")))throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}async authHeaders(e){return be([await this.apiKeyAuth(e),await this.bearerAuth(e)])}async apiKeyAuth(e){if(null!=this.apiKey)return be([{"X-Api-Key":this.apiKey}])}async bearerAuth(e){if(null!=this.authToken)return be([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new i(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${S}`}defaultIdempotencyKey(){return`stainless-node-retry-${s()}`}makeStatusError(e,t,s,n){return o.generate(e,t,s,n)}buildURL(e,s,n){const r=!t(this,jt,"m",Ut).call(this)&&n||this.baseURL,i=(e=>b.test(e))(e)?new URL(e):new URL(r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return function(e){if(!e)return!0;for(const t in e)return!1;return!0}(o)||(s={...o,...s}),"object"==typeof s&&s&&!Array.isArray(s)&&(i.search=this.stringifyQuery(s)),i.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new i("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 6e5}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new se(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){var i,o;const u=await e,h=u.maxRetries??this.maxRetries;null==t&&(t=h),await this.prepareOptions(u);const{req:d,url:p,timeout:f}=await this.buildRequest(u,{retryCount:h-t});await this.prepareRequest(d,{url:p,options:u});const g="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),m=void 0===s?"":`, retryOf: ${s}`,y=Date.now();if(K(this).debug(`[${g}] sending request`,V({retryOfRequestLogID:s,method:u.method,url:p,options:u,headers:d.headers})),null==(i=u.signal)?void 0:i.aborted)throw new a;const b=new AbortController,w=await this.fetchWithTimeout(p,d,f,b).catch(r),v=Date.now();if(w instanceof Error){const e=`retrying, ${t} attempts remaining`;if(null==(o=u.signal)?void 0:o.aborted)throw new a;const r=n(w)||/timed? ?out/i.test(String(w)+("cause"in w?String(w.cause):""));if(t)return K(this).info(`[${g}] connection ${r?"timed out":"failed"} - ${e}`),K(this).debug(`[${g}] connection ${r?"timed out":"failed"} (${e})`,V({retryOfRequestLogID:s,url:p,durationMs:v-y,message:w.message})),this.retryRequest(u,t,s??g);if(K(this).info(`[${g}] connection ${r?"timed out":"failed"} - error; no more retries left`),K(this).debug(`[${g}] connection ${r?"timed out":"failed"} (error; no more retries left)`,V({retryOfRequestLogID:s,url:p,durationMs:v-y,message:w.message})),r)throw new c;throw new l({cause:w})}const _=`[${g}${m}${[...w.headers.entries()].filter(([e])=>"request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join("")}] ${d.method} ${p} ${w.ok?"succeeded":"failed"} with status ${w.status} in ${v-y}ms`;if(!w.ok){const e=await this.shouldRetry(w);if(t&&e){const e=`retrying, ${t} attempts remaining`;return await async function(e){var t,s;if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void(await(null==(s=(t=e[Symbol.asyncIterator]()).return)?void 0:s.call(t)));const n=e.getReader(),r=n.cancel();n.releaseLock(),await r}(w.body),K(this).info(`${_} - ${e}`),K(this).debug(`[${g}] response error (${e})`,V({retryOfRequestLogID:s,url:w.url,status:w.status,headers:w.headers,durationMs:v-y})),this.retryRequest(u,t,s??g,w.headers)}const n=e?"error; no more retries left":"error; not retryable";K(this).info(`${_} - ${n}`);const i=await w.text().catch(e=>r(e).message),o=k(i),a=o?void 0:i;K(this).debug(`[${g}] response error (${n})`,V({retryOfRequestLogID:s,url:w.url,status:w.status,headers:w.headers,message:a,durationMs:Date.now()-y}));throw this.makeStatusError(w.status,o,a,w.headers)}return K(this).info(_),K(this).debug(`[${g}] response start`,V({retryOfRequestLogID:s,url:w.url,status:w.status,headers:w.headers,durationMs:v-y})),{response:w,options:u,controller:b,requestLogID:g,retryOfRequestLogID:s,startTime:y}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){const s=this.makeRequest(t,null,void 0);return new re(this,s,e)}async fetchWithTimeout(e,t,s,n){const{signal:r,method:i,...o}=t||{};r&&r.addEventListener("abort",()=>n.abort());const a=setTimeout(()=>n.abort(),s),l=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||"object"==typeof o.body&&null!==o.body&&Symbol.asyncIterator in o.body,c={signal:n.signal,...l?{duplex:"half"}:{},method:"GET",...o};i&&(c.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(a)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,t,s,n){let r;const i=null==n?void 0:n.get("retry-after-ms");if(i){const e=parseFloat(i);Number.isNaN(e)||(r=e)}const o=null==n?void 0:n.get("retry-after");if(o&&!r){const e=parseFloat(o);r=Number.isNaN(e)?Date.parse(o)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){const s=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,s)}var a;return await(a=r,new Promise(e=>setTimeout(e,a))),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){const s=t-e;return Math.min(.5*Math.pow(2,s),8)*(1-.25*Math.random())*1e3}calculateNonstreamingTimeout(e,t){const s=6e5;if(36e5*e/128e3>s||null!=t&&e>t)throw new i("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return s}async buildRequest(e,{retryCount:t=0}={}){const s={...e},{method:n,path:r,query:o,defaultBaseURL:a}=s,l=this.buildURL(r,o,a);"timeout"in s&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new i(`${e} must be an integer`);if(t<0)throw new i(`${e} must be a positive integer`)})("timeout",s.timeout),s.timeout=s.timeout??this.timeout;const{bodyHeaders:c,body:u}=this.buildBody({options:s});return{req:{method:n,headers:await this.buildHeaders({options:e,method:n,bodyHeaders:c,retryCount:t}),...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&u instanceof globalThis.ReadableStream&&{duplex:"half"},...u&&{body:u},...this.fetchOptions??{},...s.fetchOptions??{}},url:l,timeout:s.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:n}){let r={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);const i=be([r,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...$??($=x()),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},await this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:s}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=be([s]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&n.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:P(e)}:t(this,Nt,"f").call(this,{body:e,headers:n})}}Lt=Wt,Nt=new WeakMap,jt=new WeakSet,Ut=function(){return"https://api.anthropic.com"!==this.baseURL},Wt.Anthropic=Lt,Wt.HUMAN_PROMPT="\n\nHuman:",Wt.AI_PROMPT="\n\nAssistant:",Wt.DEFAULT_TIMEOUT=6e5,Wt.AnthropicError=i,Wt.APIError=o,Wt.APIConnectionError=l,Wt.APIConnectionTimeoutError=c,Wt.APIUserAbortError=a,Wt.NotFoundError=p,Wt.ConflictError=f,Wt.RateLimitError=m,Wt.BadRequestError=u,Wt.AuthenticationError=h,Wt.InternalServerError=y,Wt.PermissionDeniedError=d,Wt.UnprocessableEntityError=g,Wt.toFile=async function(e,t,s){if(oe(),e=await e,t||(t=le(e)),(e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&pe(e))(e))return e instanceof File&&null==t&&null==s?e:ae([await e.arrayBuffer()],t??e.name,{type:e.type,lastModified:e.lastModified,...s});if((e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob)(e)){const n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),ae(await fe(n),t,s)}const n=await fe(e);if(!(null==s?void 0:s.type)){const e=n.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return ae(n,t,s)};class Dt extends Wt{constructor(){super(...arguments),this.completions=new nt(this),this.messages=new qt(this),this.models=new Tt(this),this.beta=new st(this)}}Dt.Completions=nt,Dt.Messages=qt,Dt.Models=Tt,Dt.Beta=st;
